<p align="center">
    <a href="https://www.kotlinorm.com">
        <img src="https://cdn.leinbo.com/assets/images/kronos/logo_dark.png" alt="logo" height="256" width="256">
    </a>
</p>

---------

<h1 align="center">
    Kronos-ORM
</h1>

[English](https://github.com/Kronos-orm/Kronos-orm/blob/main/README.MD) | ç®€ä½“ä¸­æ–‡

<h3 align="center">
ä¸ºKotlinè®¾è®¡çš„ç°ä»£ORMæ¡†æ¶ã€‚
</h3>
<div align="center">

Kronosæ˜¯ä¸€ä¸ªä¸ºKotlinè®¾è®¡çš„ç°ä»£ORMæ¡†æ¶ï¼Œ**é€‚ç”¨äºåç«¯å’Œç§»åŠ¨åº”ç”¨ï¼Œæ”¯æŒå¤šæ•°æ®åº“, é«˜æ€§èƒ½**ã€‚

KCPå®ç°çš„è¡¨è¾¾å¼æ ‘åˆ†ææ”¯æŒä»¥åŠKotlinæœ¬èº«æ³›å‹ã€é«˜é˜¶å‡½æ•°ã€æ‰©å±•å‡½æ•°ç­‰è¯­æ³•ç‰¹æ€§ï¼Œè®©Kronosæ‹¥æœ‰**å¼ºå¤§çš„è¡¨ç°åŠ›å’Œç®€æ´ã€è¯­ä¹‰åŒ–çš„å†™æ³•**ï¼Œ**ä½¿æ“ä½œæ•°æ®åº“å˜å¾—æ›´åŠ ç®€å•**ã€‚

[![Codacy Badge](https://app.codacy.com/project/badge/Grade/1839b25a691b49ee93a0ace2a6255cb0)](https://app.codacy.com/gh/Kronos-orm/Kronos-orm/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
[![build](https://github.com/kronos-orm/kronos-orm/actions/workflows/reviewdog.yml/badge.svg)](https://github.com/kronos-orm/kronos-orm/actions/workflows/reviewdog.yml)
[![Maven central](https://img.shields.io/maven-central/v/com.kotoframework/koto-core.svg?label=Maven%20Central)](https://search.maven.org/search?q=g:%22com.kotoframework%22)
[![Sonatype Nexus (Snapshots)](https://img.shields.io/nexus/s/https/s01.oss.sonatype.org/com.kotoframework/koto-core.svg)](https://s01.oss.sonatype.org/content/repositories/snapshots/com/kotoframework/)
[![License](https://img.shields.io/:license-apache-brightgreen.svg)](https://www.apache.org/licenses/LICENSE-2.0.html)

[å®˜ç½‘](https://www.kotlinorm.com) | [ä¸­æ–‡æ–‡æ¡£](https://kotlinorm.com/#/documentation/zh-CN/getting-started/quick-start)
</div>

--------

# é‡æ–°å®šä¹‰ Kotlin ORM

â“ **ä¸ºä»€ä¹ˆé€‰æ‹© Kronos?**

* å¯ä»¥ä½¿ç”¨jvmå¹³å°çš„**å…¨éƒ¨ç”Ÿæ€å’Œèµ„æº**ï¼Œå¦‚**æ•°æ®åº“é©±åŠ¨å’Œæ—¥å¿—æ¡†æ¶**ç­‰ï¼Œæœªæ¥å¯èƒ½æ”¯æŒkotlinå¤šå¹³å°
* **Kotlin ç¼–è¯‘å™¨æ’ä»¶å’Œåç¨‹é©±åŠ¨**ï¼Œæ˜¾è‘—**å‡å°‘åå°„çš„ä½¿ç”¨**ï¼Œæä¾›**é«˜æ€§èƒ½**çš„æ•°æ®åº“æ“ä½œä½“éªŒ
* æ”¯æŒå¤§å¤šæ•°**ä¸»æµæ•°æ®åº“**ä¸”æ”¯æŒè‡ªç”±åœ°é€šè¿‡æ’ä»¶**æ·»åŠ æ•°æ®åº“æ‰©å±•**
* **ä¹¦å†™ç®€æ´ã€å¯Œæœ‰è¡¨ç°åŠ›ï¼Œæ”¯æŒ Kotlin åŸç”Ÿè¯­æ³•** `==`ã€`>`ã€`<`ã€`in` ç­‰ï¼Œè€Œä¸æ˜¯ .eqã€.gtã€.lt ç­‰
* å¼ºç±»å‹æ£€æŸ¥
* æ”¯æŒ**äº‹åŠ¡**ã€**æ— å¤–é”®å¤æ‚çº§è”æ“ä½œï¼ˆä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼‰**ã€**åºåˆ—åŒ–ååºåˆ—åŒ–**ã€**è·¨æ•°æ®åº“æŸ¥è¯¢**ã€**æ•°æ®åº“è¡¨/ç´¢å¼•/å¤‡æ³¨åˆ›å»ºå’Œç»“æ„åŒæ­¥**ç­‰åŠŸèƒ½
* æ”¯æŒ**é€»è¾‘åˆ é™¤**ã€**ä¹è§‚é”**ã€**åˆ›å»ºæ—¶é—´**ã€**æ›´æ–°æ—¶é—´**ï¼Œä¸”æ”¯æŒçµæ´»çš„è‡ªå®šä¹‰è®¾ç½®
* è½»æ¾ä¸ä»»ä½•ç¬¬ä¸‰æ–¹æ¡†æ¶é›†æˆ
* **åŸºäºå‘½åå‚æ•°çš„åŸç”ŸSQLæ•°æ®åº“æ“ä½œ**
* é€šè¿‡ç¼–è¯‘æœŸæ“ä½œï¼Œæ”¯æŒè½»æ¾å°†**æ•°æ®å®ä½“ç±»è½¬æ¢ä¸ºMapæˆ–ä»Mapè½¬æ¢ä¸ºæ•°æ®å®ä½“ç±»**ï¼Œå¹¶ä¸”**æ— åå°„ï¼Œè¿‘ä¹é›¶å¼€é”€**
* æ•°æ®ç±»å°±å¯ä»¥å½“ä½œæ•°æ®åº“è¡¨æ¨¡å‹ï¼Œ**æ˜¾è‘—å‡å°‘é¢å¤–çš„ç±»å®šä¹‰**

-------

## ğŸ–¥ JDKã€Kotlin å’Œæ„å»ºå·¥å…·

- **JDK 8+**
- **Kotlin 2.0.0+**
- **Maven 3.6.3+** or **Gradle 6.8.3+**

> è¯·ç¡®ä¿ç”¨äº IDE çš„ kotlin æ’ä»¶æ”¯æŒ kotlin 2.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
>
> å¦‚æœæ‚¨åœ¨ **Intellij IDEA** ä¸­æ„å»ºå¤±è´¥ï¼Œå¹¶ä½¿ç”¨ **Maven** æ„å»ºã€
> è¯·å°è¯•å¯ç”¨ä»¥ä¸‹è®¾ç½®: **Settings / Build, Execution, Deployment / Build Tools / Maven / Runner /
Delegate IDE build/run actions to Maven**.
-------

## ğŸ“¦ å®‰è£…

<summary>

### Gradle(kts)

</summary>

<details>

```kotlin
plugins {
    id("com.kotlinorm.kronos-gradle-plugin") version "2.0.0"
}

dependencies {
    implementation("com.kotlinorm:kronos-core:2.0.0")
}
```

</details>

<summary>

### Gradle(groovy)

</summary>

<details>

```groovy
plugins {
    id 'com.kotlinorm.kronos-gradle-plugin' version '2.0.0'
}

dependencies {
    implementation 'com.kotlinorm:kronos-core:2.0.0'
}
```

</details>

<summary>

### Maven

</summary>

<details>

```xml

<project>
    <dependencies>
        <dependency>
            <groupId>com.kotlinorm</groupId>
            <artifactId>kronos-core</artifactId>
            <version>2.0.0</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.jetbrains.kotlin</groupId>
                <artifactId>kotlin-maven-plugin</artifactId>
                <extensions>true</extensions>
                <configuration>
                    <compilerPlugins>
                        <plugin>kronos-maven-plugin</plugin>
                    </compilerPlugins>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>com.kotlinorm</groupId>
                        <artifactId>kronos-maven-plugin</artifactId>
                        <version>2.0.0</version>
                    </dependency>
                </dependencies>
            </plugin>
        </plugins>
    </build>
</project>
```

</details>

## ğŸš€ å¿«é€Ÿå…¥é—¨

### ğŸ”— è¿æ¥æ•°æ®åº“

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®é»˜è®¤æ•°æ®æº

```kotlin
Kronos.dataSource = { KronosBasicWrapper(SomeDataSource()) }
// å…·ä½“æ•°æ®æºçš„ç¤ºä¾‹ï¼š
//Kronos.dataSource = { KronosBasicWrapper(MysqlDataSource("jdbc:mysql://localhost:3306/test", "root", "***")) }
//Kronos.dataSource = { KronosBasicWrapper(HikariDataSource().apply { jdbcUrl = "jdbc:mysql://localhost:3306/test" ... }) }
//Kronos.dataSource = { KronosBasicWrapper(BasicDataSource().apply { url = "jdbc:sqlite:path/to/db" ... }) }
```

æœ‰å…³è¿æ¥æ•°æ®åº“å’Œä½¿ç”¨åŠ¨æ€æ•°æ®æºæˆ–å¤šä¸ªæ•°æ®æºçš„æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚é˜…
æ–‡æ¡£](https://kotlinorm.com/#/documentation/zh-CN/database/connect-to-db)ã€‚

### ğŸ¨ Table Model Definition(Annotation Style)

```kotlin
@Table(name = "tb_movie")
@TableIndex("idx_name", ["name"], Mysql.KIndexType.UNIQUE, Mysql.KIndexMethod.BTREE)
data class Movie(
    @PrimaryKey(identity = true)
    val id: Long? = null,// ä¸»é”®å’Œè‡ªåŠ¨é€’å¢
    val name: String? = null, // ç”µå½±åç§°
    val directorId: Long? = null, // å¯¼æ¼” ID
    @Cascade(["directorId"], ["id"])
    val director: Director? = null, // çº§è”å…³ç³»ï¼šä¸€å¯¹å¤š
    val relations: List<MovieActorRelation>? = null, // çº§è”å…³ç³»ï¼šå¤šå¯¹å¤š
    @Serializable
    val type: List<String>? = null, // ä»å­—ç¬¦ä¸²ååºåˆ—åŒ–
    @Column("movie_summary")
    val summary: String? = null, // ç”µå½±æ‘˜è¦ï¼Œåˆ—åˆ«å
    @Version val version: Long? = null, // ä¹è§‚é”çš„ç‰ˆæœ¬
    @LogicDelete val deleted: Boolean? = null, // é€»è¾‘åˆ é™¤
    @DateTimeFormat("yyyy-MM-dd HH:mm:ss")
    @UpdateTime val updateTime: String? = null, // æ›´æ–°æ—¶é—´ï¼Œæ—¥æœŸæ ¼å¼åŒ–
    @CreateTime val createTime: LocalDateTime? = null // åˆ›å»ºæ—¶é—´
) : KPojo { // KPojo æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨äºæ ‡è®°å®ä½“ç±»
    var actors: List<Actor>? by manyToMany(::relations) // ä½¿ç”¨ Kotlin å§”æ‰˜ç®€åŒ–å¤šå¯¹å¤šå…³ç³»çš„æ“ä½œ
}
```

### ğŸ¨ Table Model Definition(Dsl é£æ ¼)

å³å°†æ¨å‡º...

------------

### ğŸ“ å°† `KPojo` è½¬æ¢ä¸º Map æˆ–å°† Map è½¬æ¢ä¸º `KPojo`

å°† `KPojo` è½¬æ¢ä¸º Map æˆ–ä» Map è½¬æ¢ä¸º `KPojo` éƒ½å¾ˆå®¹æ˜“ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡
kronosTable` å’Œ `kronosColumns` æ–¹æ³•è·å–è¡¨åå’Œåˆ—ä¿¡æ¯ã€‚

```kotlin
val movie = Movie(1)
val dataMap: Map<String, Any?> = movie.toDataMap() // Map("id" = 1)
val movie2: Movie = dataMap.mapperTo<Movie>() // or dataMap.mapperTo(Movie::class)
val tableName = movie.kronosTable() // "tb_movie", æ²¡æœ‰ä½¿ç”¨åå°„
val columns = movie.kronosColumns() // [Field(id), Field(name), ...], æ²¡æœ‰ä½¿ç”¨åå°„
```

------

### ğŸ”¨ Table Operation

```kotlin
// è¡¨æ˜¯å¦å­˜åœ¨
dataSource.table.exists<Movie>()

// åˆ›å»ºè¡¨
dataSource.table.createTable<Movie>()

// åˆ é™¤è¡¨
dataSource.table.dropTable<Movie>()
// æˆ–è€…
dataSource.table.dropTable("tb_movie")

// åŒæ­¥è¡¨ç»“æ„
dataSource.table.syncTable<Movie>()
```

------

### ğŸ“œ Query

```kotlin
// ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼ŒåŒ…æ‹¬æŒ‡å®šå­—æ®µã€æ¡ä»¶ã€æ’åºã€åˆ†ç»„ã€å»é‡
val listOfUser: List<User> = User()
    .select { it.id + it.username }
    .where { it.id < 10 && it.age >= 18 }
    .distinct()
    .groupBy { it.id }
    .orderBy { it.username.desc() }
    .queryList()

// å¸¦æœ‰åˆ†é¡µå’Œæ€»æ•°æŸ¥è¯¢
val (total, list) = User()
    .select { it.id + it.username }
    .where { it.id < 10 && it.username like "a%" }
    .distinct()
    .groupBy { it.id }
    .orderBy { it.username.desc() }
    .page(1, 10)
    .withTotal()
    .queryList()

// è”è¡¨æŸ¥è¯¢
val listOfMap = User().join(UserRelation(), UserRole()) { user, relation, role ->
    on { user.id == relation.userId && user.id == role.userId }
    select {
        user.id + user.username + relation.id.`as`("relationId") +
                role.role + "count(1) as count"
    }
    where { user.id < 10 }
}.query()
```

### â• Insert

```kotlin
// æ’å…¥å•ä¸ªå®ä½“
user.insert().execute()

// æ’å…¥å¤šä¸ªå®ä½“
listOfUser.insert().execute()
```

### âœï¸ Update

```kotlin
// ä½¿ç”¨setå‡½æ•°æ›´æ–°
user.update()
    .set {
        it.username = "123"
        it.score += 10
    }
    .by { it.id }
    .execute()

// æ ¹æ®æŸäº›æ¡ä»¶æ›´æ–°ï¼Œæ›´æ–°çš„æ•°æ®æ¥è‡ªä¼ å…¥çš„è®°å½•
user.update { it.username + it.gender }
    .by { it.id }
    .execute()
```

### ğŸ”„ Upsert

```kotlin
// åœ¨æŸäº›åˆ—ä¸Šæ‰§è¡Œæ’å…¥æˆ–æ›´æ–°
user.upsert { it.username }
    .on { it.id }
//  .lock(PessimisticLock.X) // æ‚¨å¯ä»¥æŒ‡å®šé”çš„ç±»å‹ï¼Œé»˜è®¤ä½¿ç”¨æ‚²è§‚é”
    .execute()

// åªæœ‰åœ¨å†²çªæ—¶æ‰æ›´æ–°
user.upsert { it.username }
    .onConfict() // æˆ‘ä»¬å®ç°äº†ä¸åŒæ•°æ®åº“çš„å…¼å®¹
    .execute()
```

### ğŸ—‘ Delete

```kotlin
// æ ¹æ®æŸäº›æ¡ä»¶åˆ é™¤è¡Œ
user.delete()
    .where { it.id == 1 }
    .execute()
```

------

## ğŸ› ï¸ ä¸ Spring æˆ–å…¶ä»–æ¡†æ¶é›†æˆ

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä»¥ä¸‹ç¤ºä¾‹é¡¹ç›®ï¼š

[SpringBoot ç¤ºä¾‹é¡¹ç›®](https://github.com/Kronos-orm/kronos-spring-demo)

## ğŸ“š å®˜æ–¹æ–‡æ¡£

å¦‚éœ€äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® [å®˜æ–¹ç½‘ç«™](https://www.kotlinorm.com) æˆ–
æ–‡æ¡£](https://kotlinorm.com/#/documentation/zh-CN/getting-started/quick-start)ã€‚

## ğŸ“œ License

Kronos-ORM éµå¾ª Apache 2.0 è®¸å¯å‘å¸ƒã€‚

## ğŸ¤ Contributing

æ›´å¤šä¿¡æ¯è¯·å‚é˜… [CONTRIBUTING.md](https://github.com/Kronos-orm/Kronos-orm/blob/main/CONTRIBUTING.md)ã€‚

## Contributors

æˆ‘ä»¬å¯¹æ‰€æœ‰å·²ç»ä¸º Kronos-ORM åšå‡ºè´¡çŒ®çš„ä¸ªäººè¡¨ç¤ºæ„Ÿè°¢ï¼

<a href="https://github.com/Kronos-orm/Kronos-orm/graphs/contributors">
  <img alt="contributors" src="https://contrib.rocks/image?repo=Kronos-orm/Kronos-orm"/>
</a>

-------------------

**å¦‚æœæ‚¨å–œæ¬¢ Kronos-ORMï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStar â­ï¸ï¼Œè°¢è°¢ï¼**
