# 11. 时序图（扩展）

下图展示运行时的主要交互顺序：

```mermaid
sequenceDiagram
  participant App as 调用方 脚本
  participant CR as ConfigReader
  participant TC as TemplateConfig
  participant DB as 数据库
  participant KT as KronosTemplate
  participant FS as 文件系统

  App->>CR: init configPath
  CR->>TC: 解析 TOML 构建 TemplateConfig
  TC->>DB: 首次访问触发 懒加载 查询
  App->>TC: 调用 template 渲染
  TC->>KT: 提供上下文 字段 索引 注释
  KT-->>App: 组装内容字符串
  App->>FS: write 输出 Kotlin 文件
```

- 应用调用 ConfigReader 的 `init(configPath)`。
- ConfigReader 构建 TemplateConfig 并挂载 Kronos。
- 首次访问元数据时触发数据库查询。
- 应用调用 `TemplateConfig.template { ... }`，模板组装输出内容。
- 调用 `write()` 完成文件落盘。

设计说明：将初始化与渲染解耦，便于在多次模板运行间复用元数据（复用全局 `codeGenConfig`）。