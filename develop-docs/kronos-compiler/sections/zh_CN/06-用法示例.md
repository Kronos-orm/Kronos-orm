# 6. 用法示例

下面给出一个最小的示例，演示编译前后的语义变化与调试输出。

## 6.1 示例代码

```kotlin
// 一个简单的实体（KPojo 为接口，示例省略 import）
class User(val id: Long, val username: String): KPojo

// 一个用于初始化映射的函数（仅示意）
@KronosInit
fun initKronos() = { /* 初始化映射、注册等 */ }

// 带有 KTableForSelect 的示例（伪 API，仅演示语义）
fun <T: KPojo> sampleSelect(block: (KTableForSelect<T>.(T) -> Unit)) {
    // ...
}

fun demo() {
    sampleSelect<User> { it ->
        it.username // + it.id.as_("uid") 等
    }
}
```

## 6.2 编译期发生了什么？

- KronosParserTransformer 收集到泛型参数 `User` 是 KPojo 的子类；
- 在 `sampleSelect` 的 lambda 体返回前，注入 IR：
  - `addFieldList(...)`，把 `it.username`（以及 alias 等）翻译为内部字段结构；
- 若 `@KronosInit` 存在，编译末尾会回放 `initKronos` 并生成 KClass 映射。

## 6.3 开启 IR dump 并查看

- 在 Gradle/Maven 中加：`-P plugin:kronos-compiler-plugin:debug=true`；
- 编译结束后，查看 `build/tmp/kronosIrDebug` 目录：
  - 每个源文件对应一个 `.ir.kt` 风格的文本；
  - 在 `sampleSelect` 的函数体中，可看到额外注入的 IR 片段；
  - 便于确认改写行为是否符合预期。
