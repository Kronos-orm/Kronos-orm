import{a as g}from"./chunk-4O45MYMC.js";import{a as k}from"./chunk-ZURMYKNO.js";import"./chunk-4JROJSXB.js";import{a as l}from"./chunk-6UJLH36S.js";import"./chunk-IXRPNEAA.js";import{J as A}from"./chunk-C2WBB6IV.js";import"./chunk-VUUK7CK3.js";import"./chunk-H7KULVEM.js";import"./chunk-72PMQN5Q.js";import{Ub as r,pa as i,rc as t,sc as p,xb as d}from"./chunk-2GGA2KC7.js";import{a as o,b as c,h as D}from"./chunk-TWZW5B45.js";var y=D(A());var u={title:"Locks in Kronos",mdFile:"./index.md",category:g},a=u;var F=[];var m={},h=m;var E='<h2 id="pessimistic-lock" href="documentation/en/advanced/some-locks" headinglink="true" class="ngde">Pessimistic lock<ng-doc-heading-anchor class="ng-doc-anchor ngde" anchor="pessimistic-lock"></ng-doc-heading-anchor></h2><p class="ngde">Kronos provides a pessimistic lock (<code class="ngde">lock</code>) function for <strong class="ngde">query</strong><code class="ngde">(select)</code> and <strong class="ngde">update insert</strong><code class="ngde">(upsert)</code> functions, and its lock level is <strong class="ngde">row lock</strong></p><p class="ngde">The <code class="ngde">lock()</code> method can <strong class="ngde">take no parameters</strong> or <strong class="ngde">take a parameter</strong><code class="ngde">lock</code>, whose type is the enumeration class <code class="ngde">PessimisticLock</code></p><p class="ngde">Currently, you can choose <strong class="ngde">exclusive lock</strong><code class="ngde">PessimisticLock.X</code> or <strong class="ngde">shared lock</strong><code class="ngde">PessimisticLock.S</code></p><p class="ngde">The following is only an example of using pessimistic lock when <strong class="ngde">query</strong><code class="ngde">(select)</code>. When using it when <strong class="ngde">update insert</strong><code class="ngde">(upsert)</code>, just replace <code class="ngde">.select()</code> with <code class="ngde">.upsert()</code></p><ng-doc-tab group="Case 1" name="kotlin" icon="kotlin" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-kotlin"><span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">val</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> listOfUser: </span><span style="color:#6F42C1;--shiki-dark:#59C2FF" class="ngde">List</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#59C2FF" class="ngde">User</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">> </span><span style="color:#D73A49;--shiki-dark:#F29668" class="ngde">=</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde"> User</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">().</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">select</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">()</span></span>\n<span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">                          .</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">lock</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">()</span></span>\n<span class="line"><span style="color:#6A737D;--shiki-dark:#ACB6BF8C;font-style:inherit;--shiki-dark-font-style:italic" class="ngde">//                          .lock(PessimisticLock.X)</span></span>\n<span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">                          .</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">queryList</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">()</span></span>\n<span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">                          </span></span>\n<span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">val</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> listOfUser: </span><span style="color:#6F42C1;--shiki-dark:#59C2FF" class="ngde">List</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#59C2FF" class="ngde">User</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">> </span><span style="color:#D73A49;--shiki-dark:#F29668" class="ngde">=</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde"> User</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">().</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">select</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">()</span></span>\n<span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">                          .</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">lock</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">(PessimisticLock.S)</span></span>\n<span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">                          .</span><span style="color:#6F42C1;--shiki-dark:#FFB454" class="ngde">queryList</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">()</span></span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="Mysql" icon="mysql" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-sql"><span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> `id`</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">`name`</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">`age`</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> `user`</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FOR</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> UPDATE</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> `id`</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">`name`</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">`age`</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> `user`</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> LOCK </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">IN</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> SHARE MODE</span></span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="PostgreSQL" icon="postgres" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-sql"><span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "id"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"name"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"age"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "user"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FOR</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> UPDATE</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "id"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"name"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"age"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "user"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FOR</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> SHARE</span></span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="SQLite" icon="sqlite" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-sql"><span class="line"><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"># It does </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">not</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> support adding </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">row</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> lock </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">function</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> to</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> Sqlite because Sqlite itself does </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">not</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> have </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">row</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> lock </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">function</span></span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="SQLServer" icon="sqlserver" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-sql"><span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> [id], [name], [age] </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">FROM</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> [user] OFFSET </span><span style="color:#005CC5;--shiki-dark:#D2A6FF" class="ngde">0</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> ROWS</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FETCH</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> NEXT</span><span style="color:#005CC5;--shiki-dark:#D2A6FF" class="ngde"> 10</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> ROWS</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> ONLY </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">ROWLOCK</span></span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="Oracle" icon="oracle" class="ngde"><pre class="shiki shiki-themes github-light ayu-dark" style="background-color:#fff;--shiki-dark-bg:#0b0e14;color:#24292e;--shiki-dark:#bfbdb6" tabindex="0"><code class="language-sql"><span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "id"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"name"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"age"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "user"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FOR</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> UPDATE</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">(</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">NOWAIT</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">SELECT</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "id"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"name"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde">, </span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde">"age"</span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde"> FROM</span><span style="color:#032F62;--shiki-dark:#AAD94C" class="ngde"> "user"</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> LOCK </span><span style="color:#D73A49;--shiki-dark:#FF8F40" class="ngde">IN</span><span style="color:#24292E;--shiki-dark:#BFBDB6" class="ngde"> SHARE MODE</span></span></code></pre></ng-doc-tab><h2 id="optimistic-lock" href="documentation/en/advanced/some-locks" headinglink="true" class="ngde">Optimistic lock<ng-doc-heading-anchor class="ng-doc-anchor ngde" anchor="optimistic-lock"></ng-doc-heading-anchor></h2><p class="ngde">Kronos provides the <strong class="ngde">optimistic lock</strong> function (for specific activation and usage methods, see: \uFF08<a href="/documentation/en/class-definition/table-class-definition#optimistic-lock-strategy" class="ngde">Optimistic Lock Strategy</a>)</p><p class="ngde">The column set to <strong class="ngde">optimistic lock</strong> (default is <code class="ngde">version</code>, which is used as an example below) will be set to 0 when the record is created, and <code class="ngde">version = version + 1</code> for each subsequent update</p><p class="ngde">When performing the <strong class="ngde">update insert</strong><code class="ngde"> (upsert)</code> operation, the <code class="ngde">version</code> field will be added to the filter item, which means that the data will be updated only when the field in Kpojo is consistent with the number of modifications in the database, otherwise the insert will be executed</p>',b=(()=>{let s=class s extends l{constructor(){super(),this.pageType="guide",this.pageContent=E,this.editSourceFileUrl="https://github.com/Kronos-orm/Kronos-orm/edit/docs/src/app/docs/en/advanced/some-locks/index.md?message=docs(): describe your changes here...",this.viewSourceFileUrl="https://github.com/Kronos-orm/Kronos-orm/blob/docs/src/app/docs/en/advanced/some-locks/index.md",this.page=a,this.demoAssets=h}};s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=i({type:s,selectors:[["ng-doc-page-bghn63jq"]],standalone:!0,features:[t([{provide:l,useExisting:s},F,a.providers??[]]),d,p],decls:1,vars:0,template:function(n,f){n&1&&r(0,"ng-doc-page")},dependencies:[k],encapsulation:2,changeDetection:0});let e=s;return e})(),C=[c(o({},(0,y.isRoute)(a.route)?a.route:{}),{path:"",component:b,title:"Locks in Kronos"})],N=C;export{b as PageComponent,N as default};
