import{a as h}from"./chunk-D7XGFYXQ.js";import{a as r}from"./chunk-HNPVF6HZ.js";import{a as o}from"./chunk-YGVJYOZD.js";import{H as j}from"./chunk-HT2ZSXJU.js";import{Pb as t,jc as g,kc as p,ra as d,xb as i}from"./chunk-W2MTHNV2.js";import{a as l,b as c,g as w}from"./chunk-ODN5LVDJ.js";var u=w(j());var f={title:"Locks in Kronos",mdFile:"./index.md",category:h},e=f;var k=[];var O={},m=O;var L=`<h1 id="locks-in-kronos" class="ngde">Locks in Kronos<a title="Link to heading" class="ng-doc-header-link ngde" href="/en/advanced/some-locks#locks-in-kronos"><ng-doc-icon icon="link-2" size="16" class="ngde"></ng-doc-icon></a></h1><h2 id="pessimistic-lock" class="ngde">Pessimistic lock<a title="Link to heading" class="ng-doc-header-link ngde" href="/en/advanced/some-locks#pessimistic-lock"><ng-doc-icon icon="link-2" size="16" class="ngde"></ng-doc-icon></a></h2><p class="ngde">Kronos provides a pessimistic lock (<code class="ngde">lock</code>) function for <strong class="ngde">query</strong><code class="ngde">(select)</code> and <strong class="ngde">update insert</strong><code class="ngde">(upsert)</code> functions, and its lock level is <strong class="ngde">row lock</strong></p><p class="ngde">The <code class="ngde">lock()</code> method can <strong class="ngde">take no parameters</strong> or <strong class="ngde">take a parameter</strong><code class="ngde">lock</code>, whose type is the enumeration class <code class="ngde">PessimisticLock</code></p><p class="ngde">Currently, you can choose <strong class="ngde">exclusive lock</strong><code class="ngde">PessimisticLock.X</code> or <strong class="ngde">shared lock</strong><code class="ngde">PessimisticLock.S</code></p><p class="ngde">The following is only an example of using pessimistic lock when <strong class="ngde">query</strong><code class="ngde">(select)</code>. When using it when <strong class="ngde">update insert</strong><code class="ngde">(upsert)</code>, just replace <code class="ngde">.select()</code> with <code class="ngde">.upsert()</code></p><ng-doc-tab group="Case 1" name="kotlin" icon="kotlin" class="ngde"><pre class="ngde hljs"><code class="hljs language-kotlin code-lines ngde" lang="kotlin" name="" icon="" highlightedlines="[]"><span class="line ngde"><span class="hljs-keyword ngde">val</span> listOfUser: List&#x3C;User> = User().select()
</span><span class="line ngde">                          .lock()
</span><span class="line ngde"><span class="hljs-comment ngde">//                          .lock(PessimisticLock.X)</span>
</span><span class="line ngde">                          .queryList()
</span><span class="line ngde">                          
</span><span class="line ngde"><span class="hljs-keyword ngde">val</span> listOfUser: List&#x3C;User> = User().select()
</span><span class="line ngde">                          .lock(PessimisticLock.S)
</span><span class="line ngde">                          .queryList()
</span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="Mysql" icon="mysql" class="ngde"><pre class="ngde hljs"><code class="hljs language-sql code-lines ngde" lang="sql" name="" icon="" highlightedlines="[]"><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> \`id\`, \`name\`, \`age\` <span class="hljs-keyword ngde">FROM</span> \`<span class="hljs-keyword ngde">user</span>\` <span class="hljs-keyword ngde">FOR</span> <span class="hljs-keyword ngde">UPDATE</span>
</span><span class="line ngde">
</span><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> \`id\`, \`name\`, \`age\` <span class="hljs-keyword ngde">FROM</span> \`<span class="hljs-keyword ngde">user</span>\` LOCK <span class="hljs-keyword ngde">IN</span> SHARE MODE
</span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="PostgreSQL" icon="postgres" class="ngde"><pre class="ngde hljs"><code class="hljs language-sql code-lines ngde" lang="sql" name="" icon="" highlightedlines="[]"><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> "id", "name", "age" <span class="hljs-keyword ngde">FROM</span> "user" <span class="hljs-keyword ngde">FOR</span> <span class="hljs-keyword ngde">UPDATE</span>
</span><span class="line ngde">
</span><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> "id", "name", "age" <span class="hljs-keyword ngde">FROM</span> "user" <span class="hljs-keyword ngde">FOR</span> SHARE
</span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="SQLite" icon="sqlite" class="ngde"><pre class="ngde hljs"><code class="hljs language-sql code-lines ngde" lang="sql" name="" icon="" highlightedlines="[]"><span class="line ngde"># It does <span class="hljs-keyword ngde">not</span> support adding <span class="hljs-type ngde">row</span> lock <span class="hljs-keyword ngde">function</span> <span class="hljs-keyword ngde">to</span> Sqlite because Sqlite itself does <span class="hljs-keyword ngde">not</span> have <span class="hljs-type ngde">row</span> lock <span class="hljs-keyword ngde">function</span>
</span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="SQLServer" icon="sqlserver" class="ngde"><pre class="ngde hljs"><code class="hljs language-sql code-lines ngde" lang="sql" name="" icon="" highlightedlines="[]"><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> [id], [name], [age] <span class="hljs-keyword ngde">FROM</span> [<span class="hljs-keyword ngde">user</span>] <span class="hljs-keyword ngde">OFFSET</span> <span class="hljs-number ngde">0</span> <span class="hljs-keyword ngde">ROWS</span> <span class="hljs-keyword ngde">FETCH</span> NEXT <span class="hljs-number ngde">10</span> <span class="hljs-keyword ngde">ROWS</span> <span class="hljs-keyword ngde">ONLY</span> ROWLOCK
</span></code></pre></ng-doc-tab><ng-doc-tab group="Case 1" name="Oracle" icon="oracle" class="ngde"><pre class="ngde hljs"><code class="hljs language-sql code-lines ngde" lang="sql" name="" icon="" highlightedlines="[]"><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> "id", "name", "age" <span class="hljs-keyword ngde">FROM</span> "user" <span class="hljs-keyword ngde">FOR</span> <span class="hljs-keyword ngde">UPDATE</span>(NOWAIT)
</span><span class="line ngde">
</span><span class="line ngde"><span class="hljs-keyword ngde">SELECT</span> "id", "name", "age" <span class="hljs-keyword ngde">FROM</span> "user" LOCK <span class="hljs-keyword ngde">IN</span> SHARE MODE
</span></code></pre></ng-doc-tab><h2 id="optimistic-lock" class="ngde">Optimistic lock<a title="Link to heading" class="ng-doc-header-link ngde" href="/en/advanced/some-locks#optimistic-lock"><ng-doc-icon icon="link-2" size="16" class="ngde"></ng-doc-icon></a></h2><p class="ngde">Kronos provides the <strong class="ngde">optimistic lock</strong> function (for specific activation and usage methods, see: \uFF08<a href="/documentation/en/class-definition/table-class-definition#optimistic-lock-strategy" class="ngde">Optimistic Lock Strategy</a>)</p><p class="ngde">The column set to <strong class="ngde">optimistic lock</strong> (default is <code class="ngde">version</code>, which is used as an example below) will be set to 0 when the record is created, and <code class="ngde">version = version + 1</code> for each subsequent update</p><p class="ngde">When performing the <strong class="ngde">update insert</strong><code class="ngde"> (upsert)</code> operation, the <code class="ngde">version</code> field will be added to the filter item, which means that the data will be updated only when the field in Kpojo is consistent with the number of modifications in the database, otherwise the insert will be executed</p>`,E=(()=>{let s=class s extends o{constructor(){super(),this.routePrefix="",this.pageType="guide",this.pageContent=L,this.page=e,this.demoAssets=m}};s.\u0275fac=function(a){return new(a||s)},s.\u0275cmp=d({type:s,selectors:[["ng-doc-page-en-advanced-some-locks"]],standalone:!0,features:[g([{provide:o,useExisting:s},k,e.providers??[]]),i,p],decls:1,vars:0,template:function(a,S){a&1&&t(0,"ng-doc-page")},dependencies:[r],encapsulation:2,changeDetection:0});let n=s;return n})(),C=[c(l({},(0,u.isRoute)(e.route)?e.route:{}),{path:"",component:E,title:"Locks in Kronos"})],N=C;export{E as DynamicComponent,N as default};
